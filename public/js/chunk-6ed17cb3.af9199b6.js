(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6ed17cb3"],{"25b1":function(e,t,a){},"40ea":function(e,t,a){"use strict";var r=a("25b1");a.n(r).a},"6b59":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("456d");var r=a("bd86"),o=(a("ac6a"),a("75fc")),n=(a("7f7f"),a("c54e")),s=a("ca00");function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(a,!0).forEach(function(e){Object(r.a)(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var c={components:{csUpload:function(){return a.e("chunk-f8fdc73c").then(a.bind(null,"8422"))}},props:{treeData:{default:function(){return[]}},loading:{default:!1}},data:function(){return{expanded:[],filterText:"",isFullName:!0,treeProps:{label:"name",children:"children"},cascaderProps:{value:"goods_category_id",label:"name",children:"children",checkStrictly:!0},formStatus:"create",formLoading:!1,textMap:{create:"新增分类",update:"编辑分类"},stateButton:{create:"确定",update:"修改"},auth:{add:!1,del:!1,set:!1,enable:!1,disable:!1,move:!1},form:{parent_id:void 0,name:void 0,name_phonetic:void 0,alias:void 0,alias_phonetic:void 0,category_pic:void 0,category_ico:void 0,keywords:void 0,description:void 0,category_type:0,sort:50,is_navi:0,status:1},rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:100,message:"长度不能大于 100 个字符",trigger:"blur"}],name_phonetic:[{max:10,message:"长度不能大于 10 个字符",trigger:"blur"}],alias:[{max:50,message:"长度不能大于 50 个字符",trigger:"blur"}],alias_phonetic:[{max:10,message:"长度不能大于 10 个字符",trigger:"blur"}],category_pic:[{max:512,message:"长度不能大于 512 个字符",trigger:"blur"}],category_ico:[{max:50,message:"长度不能大于 50 个字符",trigger:"blur"}],keywords:[{max:255,message:"长度不能大于 255 个字符",trigger:"blur"}],description:[{max:255,message:"长度不能大于 255 个字符",trigger:"blur"}],category_type:[{type:"number",message:"必须为数字值",trigger:"blur"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},filters:{getPreviewUrl:function(e){return e?s.a.getImageCodeUrl(e,"goods_category"):""}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/goods/setting/category/add"),this.auth.set=this.$has("/goods/setting/category/set"),this.auth.del=this.$has("/goods/setting/category/del"),this.auth.enable=this.$has("/goods/setting/category/enable"),this.auth.disable=this.$has("/goods/setting/category/disable"),this.auth.move=this.$has("/goods/setting/category/move")},_getUploadFileList:function(e){if(e.length){var t=e[0].response;t&&200===t.status&&(this.form.category_pic=t.data[0].url)}},_getParentId:function(){var e=this.form.parent_id;return Array.isArray(e)?0<e.length?e[e.length-1]:0:e},resetForm:function(){this.form={parent_id:[],name:"",name_phonetic:"",alias:"",alias_phonetic:"",category_pic:"",category_ico:"",keywords:"",description:"",category_type:0,sort:50,is_navi:0,status:1}},resetElements:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"create";this.$nextTick(function(){t.$refs.form.clearValidate()}),this.formStatus=a,this.formLoading=!1},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},setStatusList:function(e){this.enable(this.$refs.tree.getCheckedKeys(),e)},setStatusItem:function(e,t){this.enable([e],t?0:1)},enable:function(e,t){var a=this;e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){Object(n.g)(e,t).then(function(){a.expanded=Object(o.a)(e),a.$emit("refresh"),a.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},removeList:function(){this.remove(this.$refs.tree.getCheckedKeys())},remove:function(e){var t=this;e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){Object(n.b)(e).then(function(){e.forEach(function(e){t.$refs.tree.remove(e)}),t.$refs.tree.setCheckedKeys([]),t.handleCreate("create"),t.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},refresh:function(){this.expanded=[],this.$emit("refresh")},handleCreate:function(e){this.resetForm(),this.resetElements(e),this.$refs.tree.getCurrentKey()&&this.$refs.tree.setCurrentKey(null)},create:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,Object(n.a)(l({},t.form,{parent_id:t._getParentId()})).then(function(e){t.expanded=[e.data.parent_id||e.data.goods_category_id],t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})},handleAppend:function(e){this.handleCreate("create"),this.$refs.tree.setCurrentKey(e),this.form.parent_id=e},handleNodeClick:function(e){(this.auth.add||this.auth.set)&&(this.resetForm(),this.resetElements("update"),this.form=l({},e))},update:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,Object(n.f)(l({},t.form,{parent_id:t._getParentId()})).then(function(e){t.expanded=[e.data.parent_id||e.data.goods_category_id],t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})},allowDrag:function(){return this.auth.move},handleDrop:function(t,e,a){var r=this,o={goods_category_id:t.data.goods_category_id,parent_id:t.data.parent_id},s=[];"inner"===a?o.parent_id=e.key:(o.parent_id=e.data.parent_id,e.parent.childNodes.forEach(function(e,t){s.push(e.key),e.data.sort=t+1})),Object(n.f)(l({},o)).then(function(e){t.data.parent_id=e.data.parent_id}).catch(function(){r.$emit("refresh")}),0<s.length&&Object(n.e)(s).catch(function(){r.$emit("refresh")})}}},d=(a("40ea"),a("2877")),u=Object(d.a)(c,function(){var r=this,e=r.$createElement,o=r._self._c||e;return o("div",{staticClass:"cs-p"},[o("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[r.auth.add?o("el-form-item",[o("el-button",{attrs:{disabled:r.loading},on:{click:function(e){return r.handleCreate("create")}}},[o("cs-icon",{attrs:{name:"plus"}}),r._v("\n        新增顶层分类\n      ")],1)],1):r._e(),o("el-form-item",[o("el-radio-group",{model:{value:r.isFullName,callback:function(e){r.isFullName=e},expression:"isFullName"}},[o("el-radio-button",{attrs:{disabled:r.loading,label:!0}},[o("cs-icon",{attrs:{name:"circle"}}),r._v("\n          全名\n        ")],1),o("el-radio-button",{attrs:{disabled:r.loading,label:!1}},[o("cs-icon",{attrs:{name:"adjust"}}),r._v("\n          别名\n        ")],1)],1)],1),o("el-form-item",[o("el-button-group",[r.auth.enable?o("el-button",{attrs:{disabled:r.loading},on:{click:function(e){return r.setStatusList(1)}}},[o("cs-icon",{attrs:{name:"check"}}),r._v("\n          启用\n        ")],1):r._e(),r.auth.disable?o("el-button",{attrs:{disabled:r.loading},on:{click:function(e){return r.setStatusList(0)}}},[o("cs-icon",{attrs:{name:"close"}}),r._v("\n          禁用\n        ")],1):r._e()],1)],1),o("el-form-item",[o("el-button-group",[r.auth.del?o("el-button",{attrs:{disabled:r.loading},on:{click:r.removeList}},[o("cs-icon",{attrs:{name:"trash-o"}}),r._v("\n          删除\n        ")],1):r._e(),o("el-button",{attrs:{disabled:r.loading},on:{click:r.refresh}},[o("cs-icon",{attrs:{name:"refresh"}}),r._v("\n          刷新\n        ")],1)],1)],1),o("el-form-item",{attrs:{label:"过滤"}},[o("el-input",{staticStyle:{width:"180px"},attrs:{disabled:r.loading,placeholder:"输入关键字进行过滤","prefix-icon":"el-icon-search",clearable:!0},model:{value:r.filterText,callback:function(e){r.filterText=e},expression:"filterText"}})],1),o("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:r.$route.path}})],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],attrs:{span:10}},[o("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"goods_category_id",data:r.treeData,props:r.treeProps,"filter-node-method":r.filterNode,"highlight-current":!0,"default-expanded-keys":r.expanded,"show-checkbox":!0,draggable:!0,"allow-drag":r.allowDrag},on:{"node-click":r.handleNodeClick,"node-drop":r.handleDrop},scopedSlots:r._u([{key:"default",fn:function(e){var t=e.node,a=e.data;return o("span",{staticClass:"custom-tree-node action"},[o("span",{staticClass:"brother-showing",class:{"status-tree":!a.status}},[r.auth.move?o("i",{staticClass:"fa fa-align-justify move-tree cs-mr-10"}):r._e(),a.children?o("i",{class:"fa fa-folder-"+(t.expanded?"open-o":"o")}):o("i",{staticClass:"fa fa-file-o"}),r._v("\n            "+r._s(r.isFullName?t.label:a.alias)+"\n          ")]),o("span",{staticClass:"active"},[r.auth.add?o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),r.handleAppend(a.goods_category_id)}}},[r._v("\n              新增\n            ")]):r._e(),r.auth.disable||r.auth.enable?o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),r.setStatusItem(a.goods_category_id,a.status)}}},[r._v("\n              "+r._s(a.status?"禁用":"启用")+"\n            ")]):r._e(),r.auth.del?o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),r.remove([a.goods_category_id])}}},[r._v("\n              删除\n            ")]):r._e()],1)])}}])})],1),o("el-col",{attrs:{span:14}},[r.auth.add||r.auth.set?o("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[o("div",{attrs:{slot:"header"},slot:"header"},[o("span",[r._v(r._s(r.textMap[r.formStatus]))]),"create"===r.formStatus&&r.auth.add?o("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:r.formLoading},on:{click:r.create}},[r._v("确定")]):"update"===r.formStatus&&r.auth.set?o("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:r.formLoading},on:{click:r.update}},[r._v("修改")]):r._e()],1),o("el-form",{ref:"form",attrs:{model:r.form,rules:r.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"上级分类",prop:"parent_id"}},[o("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"不选择表示顶层分类 试试搜索：手机",options:r.treeData,props:r.cascaderProps,filterable:"",clearable:""},model:{value:r.form.parent_id,callback:function(e){r.$set(r.form,"parent_id",e)},expression:"form.parent_id"}})],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入商品分类名称",clearable:!0},model:{value:r.form.name,callback:function(e){r.$set(r.form,"name",e)},expression:"form.name"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"名称首拼",prop:"name_phonetic"}},[o("el-input",{attrs:{placeholder:"不填写系统将自动识别",clearable:!0},model:{value:r.form.name_phonetic,callback:function(e){r.$set(r.form,"name_phonetic",e)},expression:"form.name_phonetic"}})],1)],1)],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"别名",prop:"alias"}},[o("el-input",{attrs:{placeholder:"可输入商品分类别名",clearable:!0},model:{value:r.form.alias,callback:function(e){r.$set(r.form,"alias",e)},expression:"form.alias"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"别名首拼",prop:"alias_phonetic"}},[o("el-input",{attrs:{placeholder:"不填写系统将自动识别",clearable:!0},model:{value:r.form.alias_phonetic,callback:function(e){r.$set(r.form,"alias_phonetic",e)},expression:"form.alias_phonetic"}})],1)],1)],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"图片",prop:"category_pic"}},[o("el-input",{attrs:{placeholder:"可输入商品分类图片",clearable:!0},model:{value:r.form.category_pic,callback:function(e){r.$set(r.form,"category_pic",e)},expression:"form.category_pic"}},[o("template",{slot:"prepend"},[r.form.category_pic?o("el-popover",{attrs:{width:"150",placement:"top",trigger:"hover"}},[o("div",{staticClass:"popover-image"},[o("el-image",{attrs:{src:r._f("getPreviewUrl")(r.form.category_pic),fit:"fill"},nativeOn:{click:function(e){return r.$preview(r.form.category_pic)}}})],1),o("cs-icon",{attrs:{slot:"reference",name:"image"},slot:"reference"})],1):r._e()],1),o("cs-upload",{attrs:{slot:"append",type:"slot",accept:"image/*",limit:1,multiple:!1},on:{confirm:r._getUploadFileList},slot:"append"},[o("el-button",{attrs:{slot:"control"},slot:"control"},[o("cs-icon",{attrs:{name:"upload"}})],1)],1)],2)],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"图标",prop:"category_ico"}},[o("el-input",{attrs:{placeholder:"可输入商品分类图标",clearable:!0},model:{value:r.form.category_ico,callback:function(e){r.$set(r.form,"category_ico",e)},expression:"form.category_ico"}})],1)],1)],1),o("el-form-item",{attrs:{label:"关键词",prop:"keywords"}},[o("el-input",{attrs:{placeholder:"可输入商品分类关键词",clearable:!0},model:{value:r.form.keywords,callback:function(e){r.$set(r.form,"keywords",e)},expression:"form.keywords"}})],1),o("el-form-item",{attrs:{label:"描述",prop:"description"}},[o("el-input",{attrs:{placeholder:"可输入商品分类描述",type:"textarea",rows:3},model:{value:r.form.description,callback:function(e){r.$set(r.form,"description",e)},expression:"form.description"}})],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"类型",prop:"category_type"}},[o("el-input-number",{staticStyle:{width:"120px"},attrs:{min:-128,max:127,"controls-position":"right"},model:{value:r.form.category_type,callback:function(e){r.$set(r.form,"category_type",e)},expression:"form.category_type"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"排序",prop:"sort"}},[o("el-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:255,"controls-position":"right"},model:{value:r.form.sort,callback:function(e){r.$set(r.form,"sort",e)},expression:"form.sort"}})],1)],1)],1),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"导航",prop:"is_navi"}},[o("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:r.form.is_navi,callback:function(e){r.$set(r.form,"is_navi",e)},expression:"form.is_navi"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"状态",prop:"status"}},[o("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:r.form.status,callback:function(e){r.$set(r.form,"status",e)},expression:"form.status"}})],1)],1)],1)],1)],1):r._e()],1)],1)],1)},[],!1,null,"0589d3be",null);t.default=u.exports}}]);